(this["webpackJsonpPluginksk-heptacom-admin-open-auth"]=this["webpackJsonpPluginksk-heptacom-admin-open-auth"]||[]).push([[1],{"b/Rg":function(e,t,n){"use strict";n.r(t);n("eq75");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!==i(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===i(t)?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=Shopware,c=(s.Component,s.Context),l="HeptacomAdminOpenAuthConfirmState";t.default={template:'{% block heptacom_admin_open_auth_user_confirm %}\n    <div class="heptacom-admin-open-auth-user-confirm-login">\n        <sw-loader\n            v-if="loading"\n        ></sw-loader>\n        <template v-else>\n            <sw-loader\n                v-if="waitingForConfirmation"\n            ></sw-loader>\n            <sw-card-section\n                class="heptacom-admin-open-auth-user-confirm-login--clients"\n                :divider="sectionDivider"\n                v-if="clients.length > 0"\n            >\n                <sw-alert\n                    v-if="popupsAreBlocked"\n                    variant="warning"\n                >\n                    {{ $tc(\'heptacom-admin-open-auth-user-confirm-login.popupsBlocked\') }}\n                </sw-alert>\n\n                <sw-button\n                    v-for="client of clients"\n                    :key="client.id"\n                    block\n                    @click="startAuthFlow(client)"\n                >\n                    {{ $t(\'heptacom-admin-open-auth-user-confirm-login.confirmWith\', {\n                        \'clientName\': client.name\n                    }) }}\n                    <sw-icon\n                        name="regular-external-link-s"\n                        small\n                    ></sw-icon>\n                </sw-button>\n            </sw-card-section>\n        </template>\n    </div>\n{% endblock %}\n',inject:["loginService","repositoryFactory"],props:{divider:{type:Boolean,default:!0}},data:function(){return{loading:!0,clients:[],waitingForConfirmation:!1,confirmationClient:null,popupsAreBlocked:null}},computed:{heptacomAdminOpenAuthClientsRepository:function(){return this.repositoryFactory.create("heptacom_admin_open_auth_client")},httpClient:function(){return this.heptacomAdminOpenAuthClientsRepository.httpClient},sectionDivider:function(){return this.divider?"bottom":""}},created:function(){this.createdComponent()},methods:{createdComponent:function(){this.loadClients()},loadClients:function(){var e=this;this.loading=!0,this.clients=[],this.getConnectedClients().then((function(t){e.clients=t})).finally((function(){e.loading=!1}))},startAuthFlow:function(e){var t=this,n=this;this.waitingForConfirmation=!0,this.popupsAreBlocked=null,this.confirmationClient=e,localStorage.removeItem(l),this.getConfirmRedirectUrl(e.id).then((function(i){var o=Math.floor((screen.width-600)/2),r=Math.floor((screen.height-600)/2),a=window.open(i,t.$t("heptacom-admin-open-auth-user-confirm-login.confirmWith",{clientName:e.name}),"location=0,status=0,width=600,height=600, top=".concat(r,", left=").concat(o)),s=null,c=window.setTimeout((function(){a&&!a.closed&&void 0!==a.closed||(n.popupsAreBlocked=!0,n.waitingForConfirmation=!1,s&&window.clearInterval(s))}),1200);try{a.focus(),n.popupsAreBlocked=!1}catch(e){return n.popupsAreBlocked=!0,n.waitingForConfirmation=!1,void window.clearTimeout(c)}s=window.setInterval((function(){if(!t.waitingForConfirmation)return window.clearInterval(s),window.clearTimeout(c),t.popupsAreBlocked=!1,void a.close();if(a.closed){window.clearInterval(s),window.clearTimeout(c),t.popupsAreBlocked=!1,t.waitingForConfirmation=!1;var e=localStorage.getItem(l);e&&t.verifyByState(JSON.parse(e).state)}}),1e3)}))},abortAuthFlow:function(){this.confirmationClient=null,this.waitingForConfirmation=!1},getConnectedClients:function(){var e=this.heptacomAdminOpenAuthClientsRepository.buildHeaders(c.api);return this.httpClient.get("/_admin/open-auth/client/list",{headers:e}).then((function(e){return e.data.data.filter((function(e){return e.connected}))}))},getConfirmRedirectUrl:function(e){var t=this.heptacomAdminOpenAuthClientsRepository.buildHeaders(c.api);return this.httpClient.get("/_admin/open-auth/".concat(e,"/confirm"),{headers:t}).then((function(e){return e.data.target}))},verifyByState:function(e){var t=this;this.httpClient.post("/oauth/token",{grant_type:"heptacom_admin_open_auth_one_time_token",client_id:"administration",scope:"user-verified",one_time_token:e},{baseURL:c.api.apiPath}).then((function(e){var n=r({},c.api);n.authToken.access=e.data.access_token;var i=r(r({},t.loginService.getBearerAuthentication()),{access:n.authToken.access});t.loginService.setBearerAuthentication(i),t.$emit("confirm",n)}))}}}},eq75:function(e,t,n){var i=n("tGPJ");i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,n("ydqr").default)("04479866",i,!0,{})},tGPJ:function(e,t,n){},ydqr:function(e,t,n){"use strict";function i(e,t){for(var n=[],i={},o=0;o<t.length;o++){var r=t[o],a=r[0],s={id:e+":"+o,css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}n.r(t),n.d(t,"default",(function(){return h}));var o="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var r={},a=o&&(document.head||document.getElementsByTagName("head")[0]),s=null,c=0,l=!1,u=function(){},p=null,d="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function h(e,t,n,o){l=n,p=o||{};var a=i(e,t);return m(a),function(t){for(var n=[],o=0;o<a.length;o++){var s=a[o];(c=r[s.id]).refs--,n.push(c)}t?m(a=i(e,t)):a=[];for(o=0;o<n.length;o++){var c;if(0===(c=n[o]).refs){for(var l=0;l<c.parts.length;l++)c.parts[l]();delete r[c.id]}}}}function m(e){for(var t=0;t<e.length;t++){var n=e[t],i=r[n.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](n.parts[o]);for(;o<n.parts.length;o++)i.parts.push(g(n.parts[o]));i.parts.length>n.parts.length&&(i.parts.length=n.parts.length)}else{var a=[];for(o=0;o<n.parts.length;o++)a.push(g(n.parts[o]));r[n.id]={id:n.id,refs:1,parts:a}}}}function v(){var e=document.createElement("style");return e.type="text/css",a.appendChild(e),e}function g(e){var t,n,i=document.querySelector("style["+d+'~="'+e.id+'"]');if(i){if(l)return u;i.parentNode.removeChild(i)}if(f){var o=c++;i=s||(s=v()),t=b.bind(null,i,o,!1),n=b.bind(null,i,o,!0)}else i=v(),t=C.bind(null,i),n=function(){i.parentNode.removeChild(i)};return t(e),function(i){if(i){if(i.css===e.css&&i.media===e.media&&i.sourceMap===e.sourceMap)return;t(e=i)}else n()}}var y,w=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join("\n")});function b(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=w(t,o);else{var r=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function C(e,t){var n=t.css,i=t.media,o=t.sourceMap;if(i&&e.setAttribute("media",i),p.ssrId&&e.setAttribute(d,t.id),o&&(n+="\n/*# sourceURL="+o.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}}}]);