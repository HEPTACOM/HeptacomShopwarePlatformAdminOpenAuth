(window["webpackJsonpPluginksk-heptacom-admin-open-auth"]=window["webpackJsonpPluginksk-heptacom-admin-open-auth"]||[]).push([[352],{69:function(){},352:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return a}}),n(738);let{Component:i,Context:o}=Shopware,r="HeptacomAdminOpenAuthConfirmState";var a={template:'{% block heptacom_admin_open_auth_user_confirm %}\n    <div class="heptacom-admin-open-auth-user-confirm-login">\n        <sw-loader\n            v-if="loading"\n        ></sw-loader>\n        <template v-else>\n            <sw-loader\n                v-if="waitingForConfirmation"\n            ></sw-loader>\n            <sw-card-section\n                class="heptacom-admin-open-auth-user-confirm-login--clients"\n                :divider="sectionDivider"\n                v-if="clients.length > 0"\n            >\n                <sw-alert\n                    v-if="popupsAreBlocked"\n                    variant="warning"\n                >\n                    {{ $tc(\'heptacom-admin-open-auth-user-confirm-login.popupsBlocked\') }}\n                </sw-alert>\n\n                <template\n                    v-for="client of clients"\n                    :key="client.id"\n                >\n                    <sw-button\n                        block\n                        @click="startAuthFlow(client)"\n                    >\n                        {{ $t(\'heptacom-admin-open-auth-user-confirm-login.confirmWith\', {\n                            \'clientName\': client.name\n                        }) }}\n                        <sw-icon\n                            name="regular-external-link-s"\n                            small\n                        ></sw-icon>\n                    </sw-button>\n                </template>\n            </sw-card-section>\n        </template>\n    </div>\n{% endblock %}\n',inject:["loginService","repositoryFactory"],props:{divider:{type:Boolean,default:!0}},data(){return{loading:!0,clients:[],waitingForConfirmation:!1,confirmationClient:null,popupsAreBlocked:null}},computed:{heptacomAdminOpenAuthClientsRepository(){return this.repositoryFactory.create("heptacom_admin_open_auth_client")},httpClient(){return this.heptacomAdminOpenAuthClientsRepository.httpClient},sectionDivider(){return this.divider?"bottom":""}},created(){this.createdComponent()},methods:{createdComponent(){this.loadClients()},loadClients(){this.loading=!0,this.clients=[],this.getConnectedClients().then(e=>{this.clients=e}).finally(()=>{this.loading=!1})},startAuthFlow(e){let t=this;this.waitingForConfirmation=!0,this.popupsAreBlocked=null,this.confirmationClient=e,localStorage.removeItem(r),this.getConfirmRedirectUrl(e.id).then(n=>{let i=Math.floor((screen.width-600)/2),o=Math.floor((screen.height-600)/2),a=window.open(n,this.$t("heptacom-admin-open-auth-user-confirm-login.confirmWith",{clientName:e.name}),`location=0,status=0,width=600,height=600, top=${o}, left=${i}`),s=null,l=window.setTimeout(()=>{(!a||a.closed||void 0===a.closed)&&(t.popupsAreBlocked=!0,t.waitingForConfirmation=!1,s&&window.clearInterval(s))},1200);try{a.focus(),t.popupsAreBlocked=!1}catch(e){t.popupsAreBlocked=!0,t.waitingForConfirmation=!1,window.clearTimeout(l);return}s=window.setInterval(()=>{if(!this.waitingForConfirmation){window.clearInterval(s),window.clearTimeout(l),this.popupsAreBlocked=!1,a.close();return}if(a.closed){window.clearInterval(s),window.clearTimeout(l),this.popupsAreBlocked=!1,this.waitingForConfirmation=!1;let e=localStorage.getItem(r);e&&this.verifyByState(JSON.parse(e).state)}},1e3)})},abortAuthFlow(){this.confirmationClient=null,this.waitingForConfirmation=!1},getConnectedClients(){let e=this.heptacomAdminOpenAuthClientsRepository.buildHeaders(o.api);return this.httpClient.get("/_admin/open-auth/client/list",{headers:e}).then(e=>e.data.data.filter(e=>e.connected))},getConfirmRedirectUrl(e){let t=this.heptacomAdminOpenAuthClientsRepository.buildHeaders(o.api);return this.httpClient.get(`/_admin/open-auth/${e}/confirm`,{headers:t}).then(e=>e.data.target)},verifyByState(e){this.httpClient.post("/oauth/token",{grant_type:"heptacom_admin_open_auth_one_time_token",client_id:"administration",scope:"user-verified",one_time_token:e},{baseURL:o.api.apiPath}).then(e=>{let t={...o.api};t.authToken.access=e.data.access_token;let n={...this.loginService.getBearerAuthentication(),access:t.authToken.access};this.loginService.setBearerAuthentication(n),this.$emit("confirm",t)})}}}},738:function(e,t,n){var i=n(69);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals),n(346).Z("337fabe9",i,!0,{})},346:function(e,t,n){"use strict";function i(e,t){for(var n=[],i={},o=0;o<t.length;o++){var r=t[o],a=r[0],s={id:e+":"+o,css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}n.d(t,{Z:function(){return m}});var o="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!o)throw Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var r={},a=o&&(document.head||document.getElementsByTagName("head")[0]),s=null,l=0,c=!1,d=function(){},p=null,u="data-vue-ssr-id",h="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(e,t,n,o){c=n,p=o||{};var a=i(e,t);return f(a),function(t){for(var n=[],o=0;o<a.length;o++){var s=r[a[o].id];s.refs--,n.push(s)}t?f(a=i(e,t)):a=[];for(var o=0;o<n.length;o++){var s=n[o];if(0===s.refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete r[s.id]}}}}function f(e){for(var t=0;t<e.length;t++){var n=e[t],i=r[n.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](n.parts[o]);for(;o<n.parts.length;o++)i.parts.push(v(n.parts[o]));i.parts.length>n.parts.length&&(i.parts.length=n.parts.length)}else{for(var a=[],o=0;o<n.parts.length;o++)a.push(v(n.parts[o]));r[n.id]={id:n.id,refs:1,parts:a}}}}function g(){var e=document.createElement("style");return e.type="text/css",a.appendChild(e),e}function v(e){var t,n,i=document.querySelector("style["+u+'~="'+e.id+'"]');if(i){if(c)return d;i.parentNode.removeChild(i)}if(h){var o=l++;t=C.bind(null,i=s||(s=g()),o,!1),n=C.bind(null,i,o,!0)}else t=y.bind(null,i=g()),n=function(){i.parentNode.removeChild(i)};return t(e),function(i){i?(i.css!==e.css||i.media!==e.media||i.sourceMap!==e.sourceMap)&&t(e=i):n()}}var w=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}();function C(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=w(t,o);else{var r=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(r,a[t]):e.appendChild(r)}}function y(e,t){var n=t.css,i=t.media,o=t.sourceMap;if(i&&e.setAttribute("media",i),p.ssrId&&e.setAttribute(u,t.id),o&&(n+="\n/*# sourceURL="+o.sources[0]+" */\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}}}]);
//# sourceMappingURL=6f41ea409277f977d4d7.js.map